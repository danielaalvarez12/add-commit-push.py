import subprocess
import sys

def main():
    # Check for command-line arguments
    commit_message = ""
    if len(sys.argv) > 1 and sys.argv[1] == "-m":
        if len(sys.argv) > 2:
            commit_message = sys.argv[2]
        else:
            print("Error: Commit message is required after '-m'.")
            sys.exit(1)

    try:
        # Stage all changes
        subprocess.run(["git", "add", "."], check=True)
        print("Staged all changes.")

        # Commit with the provided message
        if commit_message:
            subprocess.run(["git", "commit", "-m", commit_message], check=True)
            print(f"Committed changes with message: '{commit_message}'")
        else:
            subprocess.run(["git", "commit", "-m", "Update"], check=True)
            print("Committed changes with default message: 'Update'")

        # Push to the remote repository
        subprocess.run(["git", "push"], check=True)
        print("Pushed changes to the remote repository.")

    except subprocess.CalledProcessError as e:
        print(f"An error occurred: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
